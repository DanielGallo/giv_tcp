version: "3.9"
services:
  GivTCP:
    image: danieljgallo/givtcp
    ports:
      - "1883:1883"
      - "6345:6345"
      - "3000:3000"                     # This should match the WEB_DASH_PORT ENV below
    environment:
      - NUMINVERTERS="1"                # Set this to the number of Inverters in your setup, then replicate the next two lines for each inverter (changing the last number of the ENV)
      - INVERTER_IP_1="10.0.0.111"      # Set this to the IP address of your Inverter on your local network
      - NUMBATTERIES_1="2"              # Number of battery modules installed and connected to the above inverter
      - MQTT_OUTPUT=True                # "True" if you want to publish your data to MQTT, "False" otherwise
      - MQTT_ADDRESS="127.0.0.1"        # IP address of an existing MQTT broker, or leave as "127.0.0.1" to use the internal broker
      - MQTT_USERNAME=""                # Username of your existing broker, if needed. Not required for internal broker
      - MQTT_PASSWORD=""                # Password of your existing broker, if needed. Not required for internal broker
      - MQTT_TOPIC=""                   # Root topic to publish data to. If left blank it will default to GivEnergy/<inverter_serial_number>
      - MQTT_PORT="1883"                # Port of your existing broker, leave as "1883" for internal broker
      - LOG_LEVEL="Info"                # Level of logs to be reported: "Error", "Info" or "Debug"
      - DEBUG_FILE_LOCATION="/config/GivTCP/log.log"          # Location of log file stored inside the container, defalt location is /app/GivTCP
      - PRINT_RAW="True"                # If True this will publish all inverotr data unprocessed as well as standard data
      - SELF_RUN="True"                 # If True the container will self-run and connect and publish data. If "False" the you will need to trigger externally via REST
      - SELF_RUN_LOOP_TIMER="5"         # Wait time between every read command to the inverter
      - INFLUX_OUTPUT="False"           # "True" if you want to publish your data to InfluxDB, "False" otherwise
      - INFLUX_URL=""                   # URL of an external Influx instance
      - INFLUX_TOKEN=""                 # Access Token for your Influx instance
      - INFLUX_BUCKET=""                # Data Bucket of your Influx instance you want data sent to
      - INFLUX_ORG=""                   # Influx instance Organisation
      - HA_AUTO_D="True"                # If True (and if MQTT_OUTPUT is True) this will publish Home Assistant Auto Discovery messages to the broker
      - HADEVICEPREFIX="GivTCP"         # Defines the preficfor all entities in Home Assistant
      - PYTHONPATH="/app"
      - DAYRATE=0.138                   # Price in £/$ for your daytime electricity per kWh
      - NIGHTRATE=0.05                  # Price in £/$ for your night time electricity per kWh
      - EXPORTRATE=0.041                # Price in £/$ for your export electricity per kWh
      - HOSTIP=""                       # External IP address of the docker host (needed for web dashboard)
      - DAYRATESTART="04:30"            # Time in HH:MM when your day time tariff kicks in
      - NIGHTRATESTART="00:30"          # Time in HH:MM when your night time tariff kicks in
      - TZ="Europe/London"              # Set to your Timezone
      - WEB_DASH="False"                # Enable the wed dashboard
      - WEB_DASH_PORT="3000"            # Port to serve the web dashboard on
    restart: always
    privileged: true